version: "2.4"
services:

  adguard:
    container_name: adguard
    image: adguard/adguardhome
    restart: always
    ports:
      - 53:53/tcp
      - 53:53/udp
      - 853:853
      - 3000:3000
    volumes:
      - ${DATA_DIR}/adguard:/opt/adguardhome/conf

  homeassistant:
    container_name: homeassistant
    image: homeassistant/home-assistant:stable
    restart: always
    network_mode: host
    volumes:
      - ${DATA_DIR}/homeassistant:/config
    labels:
      - traefik.enable=true
      - traefik.http.routers.homeassistant.rule=Host(`${DOMAIN_HOMEASSISTANT}`)
      - traefik.http.routers.homeassistant.tls=true
      - traefik.http.routers.homeassistant.tls.certresolver=default
      - traefik.http.services.homeassistant.loadbalancer.server.port=8123

  glances:
    container_name: glances
    image: blackdark93/glances
    #build: https://github.com/nicolargo/glances.git#develop:docker-files/devel-alpine
    restart: always
    environment:
      - GLANCES_OPT=
          --disable-plugin network,processcount,processlist
          -w
    ports:
      - 61208:61208
    volumes:
      - ${DATA_DIR}:/data:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro

  esphome:
    container_name: esphome
    image: esphome/esphome
    restart: always
    network_mode: host
    ports:
      - 6052:6052
    volumes:
      - ${DATA_DIR}/esphome:/config
    #devices:
      #- /dev/ttyUSB0

  grocy:
    container_name: grocy
    image: linuxserver/grocy
    restart: always
    volumes:
      - ${DATA_DIR}/grocy:/config/data
    labels:
      - traefik.enable=true
      - traefik.http.routers.grocy.rule=Host(`${DOMAIN_GROCY}`)
      - traefik.http.routers.grocy.tls=true
      - traefik.http.routers.grocy.tls.certresolver=default
      - traefik.http.services.grocy.loadbalancer.server.port=80

  deconz:
    container_name: deconz
    image: marthoc/deconz:stable
    restart: always
    network_mode: host
    devices:
      - /dev/ttyACM0
    environment:
      - DECONZ_DEVICE=/dev/ttyACM0
      - DECONZ_WEB_PORT=8080
      - DECONZ_WS_PORT=8443
      - TZ
    volumes:
      - ${DATA_DIR}/deconz:/root/.local/share/dresden-elektronik/deCONZ
